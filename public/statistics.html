<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Statistics - PolyUploader" />
  <meta property="og:url" content="https://polyuploader.vercel.app" />
  <meta property="og:image" content="https://p-u.vercel.app/assets/meta_visual.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://p-u.vercel.app/assets/meta_visual.png" />
  <meta property="og:description" content="Statistics - PolyUploader. Upload your files remotely to different hosting sites." />
  <meta name="theme-color" content="#4f46e5">
  <title>Statistics - PolyUploader</title>
  <link rel="stylesheet" href="/assets/styles.css">
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css">
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/sharp-duotone-solid.css">
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/sharp-duotone-regular.css">
  <link rel="icon" type="image/x-icon" href="https://p-u.vercel.app/assets/icon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap');

    body {
      font-family: "Space Grotesk", sans-serif;
      overflow-y: auto;
    }
</style>

<body class="bg-black text-white min-h-screen">
    <div>
        <div class="bg-[#2e288e]/30 absolute sm:w-[65rem] md:left-[-25rem] -z-10 rounded-full blur-[16vh] top-[-1rem] h-[40rem]"></div>
        <div class="bg-[#2e288e]/30 absolute sm:w-[30rem] -z-10 blur-[30vh] h-[20rem] top-[15rem] right-[0rem]"></div>
        <div class="bg-[#2e288e]/30 absolute sm:w-[50rem] md:left-[-10rem] -z-10 rounded-full blur-[16vh] top-[60rem] h-[40rem]"></div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-4xl font-bold text-white mb-3 bg-gradient-to-b from-white to-slate-400 text-transparent bg-clip-text">
                <i class="fa-sharp-duotone fa-chart-simple text-indigo-400 mr-2"></i>
                Telemetry dashboard
            </h1>
            <p class="text-gray-400 text-lg">PolyUploader real-time statistics</p>
        </div>

        <!-- General statistics -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wide">Total uploads</p>
                        <p class="text-3xl font-bold text-white mt-2" id="total-uploads">Loading...</p>
                    </div>
                    <div class="backdrop-blur-lg bg-indigo-500/50 p-4 rounded-2xl shadow-md border border-indigo-500">
                        <i class="fa-sharp-duotone fa-upload text-white text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wide">Total share links</p>
                        <p class="text-3xl font-bold text-white mt-2" id="total-bins">Loading...</p>
                    </div>
                    <div class="backdrop-blur-lg bg-green-500/50 p-4 rounded-2xl shadow-md border border-green-500">
                        <i class="fa-sharp-duotone fa-database text-white text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wide">Uploads today</p>
                        <p class="text-3xl font-bold text-white mt-2" id="today-uploads">Loading...</p>
                    </div>
                    <div class="backdrop-blur-lg bg-blue-500/50 p-4 rounded-2xl shadow-md border border-blue-500">
                        <i class="fa-sharp-duotone fa-calendar-day text-white text-xl"></i>
                    </div>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wide">Share links today</p>
                        <p class="text-3xl font-bold text-white mt-2" id="today-bins">Loading...</p>
                    </div>
                    <div class="backdrop-blur-lg bg-purple-500/50 p-4 rounded-2xl shadow-md border border-purple-500">
                        <i class="fa-sharp-duotone fa-calendar-day text-white text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                    <i class="fa-sharp-duotone fa-server text-indigo-400 mr-3"></i>
                    Most popular hosts (uploads)
                </h3>
                <div class="relative h-[400px]">
                    <canvas id="uploads_hosts_chart"></canvas>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                    <i class="fa-sharp-duotone fa-server text-green-400 mr-3"></i>
                    Most popular hosts (share links)
                </h3>
                <div class="relative h-[400px]">
                    <canvas id="bins_hosts_chart"></canvas>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                    <i class="fa-sharp-duotone fa-clock text-blue-400 mr-3"></i>
                    Activity per hour (uploads)
                </h3>
                <div class="relative h-80">
                    <canvas id="uploads_activity_chart"></canvas>
                </div>
            </div>

            <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
                <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                    <i class="fa-sharp-duotone fa-clock text-purple-400 mr-3"></i>
                    Activity per hour (share links)
                </h3>
                <div class="relative h-80">
                    <canvas id="bins_activity_chart"></canvas>
                </div>
            </div>
        </div>

        <!-- GitHub stats -->
        <div class="backdrop-blur-lg bg-white/7 rounded-2xl shadow-md border border-[#2D333D] p-6 hover:bg-white/9 hover:border-[#4c5666] transition duration-200">
            <h3 class="text-xl font-semibold text-white mb-6 flex items-center">
                <i class="fab fa-github text-gray-400 mr-3"></i>
                GitHub statistics
            </h3>
            <div class="backdrop-blur-lg bg-indigo-500/20 border border-indigo-500 rounded-lg p-6 font-mono text-sm">
                <div class="space-y-2">
                    <div class="flex items-center justify-between border-b border-gray-700 pb-2">
                        <span class="text-gray-300 flex items-center">
                            <i class="fa-sharp-duotone fa-regular fa-star text-yellow-400 mr-2"></i>
                            Number of stars on the GitHub repository
                        </span>
                        <span id="github_stars" class="text-white font-semibold">
                            <i class="text-gray-500 italic">Loading...</i>
                        </span>
                    </div>
                    <div class="flex items-center justify-between border-b border-gray-700 pb-2">
                        <span class="text-gray-300 flex items-center">
                            <i class="fa-sharp-duotone fa-solid fa-code-pull-request text-green-400 mr-2"></i>
                            Number of pull requests on the GitHub repository
                        </span>
                        <span id="github_pull_requests" class="text-white font-semibold">
                            <i class="text-gray-500 italic">Loading...</i>
                        </span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-300 flex items-center">
                            <i class="fa-sharp-duotone fa-solid fa-clock-rotate-left text-blue-400 mr-2"></i>
                            Date of last update
                        </span>
                        <span id="date_last_update" class="text-white font-semibold">
                            <i class="text-gray-500 italic">Loading...</i>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-base mt-10 text-slate-400 text-center space-y-2">
            <button class="px-3 py-1.5 mr-2 font-normal text-base bg-indigo-500/40 border border-indigo-300/10 hover:bg-indigo-500/60 transition text-indigo-300 duration-3.5 rounded-lg hover:shadow-[0_0px_20px_rgba(99,_102,_241,_0.1)] active:scale-[1.02]" onclick="window.open('https://polyuploader.vercel.app/', '_blank');">Documentation website <i class="ml-1 fa-sharp-duotone fa-arrow-up-right-from-square"></i></button>
            <button class="px-3 py-1.5 ml-2 mr-2 font-normal text-base bg-indigo-500/40 border border-indigo-300/10 hover:bg-indigo-500/60 transition text-indigo-300 duration-3.5 rounded-lg hover:shadow-[0_0px_20px_rgba(99,_102,_241,_0.1)] active:scale-[1.02]" onclick="window.open('https://github.com/spel987/PolyUploader', '_blank');">GitHub repository <i class="ml-1 fa-sharp-duotone fa-arrow-up-right-from-square"></i></button>
            <button class="px-3 py-1.5 ml-2 mr-2 font-normal text-base bg-indigo-500/40 border border-indigo-300/10 hover:bg-indigo-500/60 transition text-indigo-300 duration-3.5 rounded-lg hover:shadow-[0_0px_20px_rgba(99,_102,_241,_0.1)] active:scale-[1.02]" onclick="window.open('https://p-u.vercel.app/terms', '_blank');">Terms <i class="ml-1 fa-sharp-duotone fa-arrow-up-right-from-square"></i></button>
            <button class="px-3 py-1.5 ml-2 font-normal text-base bg-indigo-500/40 border border-indigo-300/10 hover:bg-indigo-500/60 transition text-indigo-300 duration-3.5 rounded-lg hover:shadow-[0_0px_20px_rgba(99,_102,_241,_0.1)] active:scale-[1.02]" onclick="window.open('https://ko-fi.com/spel987', '_blank');">Support me on Ko-Fi <i class="ml-1 fa-sharp-duotone fa-arrow-up-right-from-square"></i></button>
        </div>
    </div>

    <script>
        let uploads_hosts_chart, bins_hosts_chart, uploads_activity_chart, bins_activity_chart;

        function generate_colors(count) {
            const baseColors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                '#9966FF', '#FF9F40', '#FF6B6B', '#4ECDC4',
                '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD',
                '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
            ];
            
            const colors = [];
            for (let i = 0; i < count; i++) {
                if (i < baseColors.length) {
                    colors.push(baseColors[i]);
                } else {
                    const hue = (i * 137.508) % 360;
                    colors.push(`hsl(${hue}, 70%, 60%)`);
                }
            }
            return colors;
        }

        function generate_pie_chart(ctx, data, title) {
            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(item => item.host),
                    datasets: [{
                        data: data.map(item => item.usage_count),
                        backgroundColor: generate_colors(data.length),
                        borderWidth: 1,
                        borderColor: '#4c5666'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                color: '#D1D5DB'
                            }
                        }
                    }
                }
            });
        }

        function create_bar_chart(ctx, data, title, color) {
            const hours = Array.from({length: 24}, (_, i) => i);
            const activityData = hours.map(hour => {
                const found = data.find(item => parseInt(item.hour) === hour);
                return found ? found.activity_count : 0;
            });

            return new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours.map(h => h + 'h'),
                    datasets: [{
                        label: 'Activity',
                        data: activityData,
                        backgroundColor: color + '80',
                        borderColor: color,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#9CA3AF'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#9CA3AF'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function replace_element(element, replacement) {
            element.innerHTML = element.innerHTML.replace(/<i[^>]*>Loading...<\/i>/, replacement);
        }

        async function load_general_stats() {
            try {
                const response = await fetch('/api/statistics/general-stats');
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('total-uploads').textContent = result.data.totals.uploads;
                    document.getElementById('total-bins').textContent = result.data.totals.bins;
                    document.getElementById('today-uploads').textContent = result.data.today.uploads;
                    document.getElementById('today-bins').textContent = result.data.today.bins;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error loading general statistics:', error);
                document.getElementById('total-uploads').innerHTML = '<span class="text-red-400">Error</span>';
                document.getElementById('total-bins').innerHTML = '<span class="text-red-400">Error</span>';
                document.getElementById('today-uploads').innerHTML = '<span class="text-red-400">Error</span>';
                document.getElementById('today-bins').innerHTML = '<span class="text-red-400">Error</span>';
            }
        }

        async function load_hosts_stats() {
            try {
                const response = await fetch('/api/statistics/hosts-stats');
                const result = await response.json();
                
                if (result.success) {
                    const upload_ctx = document.getElementById('uploads_hosts_chart').getContext('2d');
                    uploads_hosts_chart = generate_pie_chart(upload_ctx, result.data.uploads, 'Uploads');

                    const bins_ctx = document.getElementById('bins_hosts_chart').getContext('2d');
                    bins_hosts_chart = generate_pie_chart(bins_ctx, result.data.bins, 'Bins');
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error loading host statistics:', error);
            }
        }

        async function load_activity_stats() {
            try {
                const response = await fetch('/api/statistics/activity-stats');
                const result = await response.json();
                
                if (result.success) {
                    const upload_activity_ctx = document.getElementById('uploads_activity_chart').getContext('2d');
                    uploads_activity_chart = create_bar_chart(upload_activity_ctx, result.data.uploads, 'Uploads per hour', '#3B82F6');

                    const bins_activity_ctx = document.getElementById('bins_activity_chart').getContext('2d');
                    bins_activity_chart = create_bar_chart(bins_activity_ctx, result.data.bins, 'Share links per hour', '#8B5CF6');
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Erreur lors du chargement des statistiques d\'activité:', error);
            }
        }

        async function load_github_stats() {
            const github_stars = document.getElementById("github_stars");
            const github_pull_requests = document.getElementById("github_pull_requests");
            const date_last_update = document.getElementById("date_last_update");

            try {
                const response = await fetch("https://api.github.com/repos/spel987/PolyUploader", {method: "GET"});
                const data = await response.json();
                
                if (data.stargazers_count) {
                    replace_element(github_stars, data.stargazers_count);
                } else if (data.message && data.message.includes("API rate limit exceeded")) {
                    replace_element(github_stars, '<span class="text-red-400">Rate limited by GitHub</span>');
                }
                
                if (data.pushed_at) {
                    const date = new Date(data.pushed_at);
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    const formatted_date = `${year}-${month}-${day}`;
                    replace_element(date_last_update, formatted_date);
                } else if (data.message && data.message.includes("API rate limit exceeded")) {
                    replace_element(date_last_update, '<span class="text-red-400">Rate limited by GitHub</span>');
                }
            } catch {
                replace_element(github_stars, '<span class="text-red-400">Error</span>');
                replace_element(date_last_update, '<span class="text-red-400">Error</span>');
            }

            try {
                const response = await fetch("https://api.github.com/repos/spel987/PolyUploader/pulls", {method: "GET"});
                const data = await response.json();
                
                if (data.length >= 0) {
                    replace_element(github_pull_requests, data.length.toString());
                } else if (data.message && data.message.includes("API rate limit exceeded")) {
                    replace_element(github_pull_requests, '<span class="text-red-400">Rate limited by GitHub</span>');
                } else {
                    replace_element(github_pull_requests, "0");
                }
            } catch {
                replace_element(github_pull_requests, '<span class="text-red-400">Error</span>');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            load_general_stats();
            load_hosts_stats();
            load_activity_stats();
            load_github_stats();

            setInterval(() => {
                load_general_stats();
                load_hosts_stats();
                load_activity_stats();
                load_github_stats();
            }, 5 * 60 * 1000);
        });
    </script>
</body>
</html>